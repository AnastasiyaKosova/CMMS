<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CMMS ‚Äî –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ–º</title>
<style>
  body {margin:0; font-family: Inter, sans-serif; background: #0f1724; color: #e6eef6; display:flex; justify-content:center; align-items:flex-start; padding-top:20px;}
  .screen {display:none; padding:20px; border-radius:12px; background: #0b1220; width:90%; max-width:800px; box-shadow:0 6px 18px rgba(2,6,23,0.6);}
  .active {display:block;}
  
  .admin-panel { background: #1e293b; border-left: 4px solid #06b6d4; }
  .question-item { background: rgba(255,255,255,0.03); padding: 12px; margin: 8px 0; border-radius: 8px; }
  .results-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  .results-table th { background: rgba(6,182,212,0.1); padding: 10px; text-align: left; }
  .results-table td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
  
  input, textarea, select {width:100%; padding:8px; margin-bottom:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#e6eef6;}
  button {padding:10px 16px; border:none; border-radius:10px; background:#06b6d4; color:#052026; cursor:pointer; margin:4px;}
  .btn-danger {background:#ef4444;}
  .btn-success {background:#10b981;}
  .btn-secondary {background:#64748b;}
  .note {font-size:12px; color:#94a3b8; margin-bottom:12px;}
  .card {background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04)); border-radius:12px; padding:14px; box-shadow:0 6px 18px rgba(2,6,23,0.6); margin-bottom:12px;}
  
  .admin-dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
  .admin-card { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; text-align: center; }
  .admin-card h3 { margin-top: 0; }
</style>
</head>
<body>

<!-- –≠–∫—Ä–∞–Ω 1: –í—Ö–æ–¥ -->
<div id="login-screen" class="screen active">
  <h2>–í—Ö–æ–¥ –≤ CMMS</h2>
  <input id="login" type="text" placeholder="–õ–æ–≥–∏–Ω">
  <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <button id="login-btn">–í–æ–π—Ç–∏</button>
  <div id="login-msg" class="note"></div>
  <div class="note">
    <strong>–¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</strong><br>
    üëë –ê–¥–º–∏–Ω: admin / admin123<br>
    ‚öôÔ∏è –ò–Ω–∂–µ–Ω–µ—Ä: engineer / engineer123
  </div>
</div>

<!-- –≠–∫—Ä–∞–Ω 2: –ê–¥–º–∏–Ω –î–∞—à–±–æ—Ä–¥ -->
<div id="admin-dashboard-screen" class="screen admin-panel">
  <h2>üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
  
  <div class="admin-dashboard">
    <div class="admin-card">
      <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—É—á–µ–Ω–∏—è</h3>
      <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
      <button id="admin-setup-btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º</button>
    </div>
    
    <div class="admin-card">
      <h3>üõ†Ô∏è –†–∞–±–æ—á–µ–µ –æ–∫–Ω–æ</h3>
      <p>–î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º —Å–∏—Å—Ç–µ–º—ã</p>
      <button id="admin-workspace-btn">–ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–±–æ—á–µ–µ –æ–∫–Ω–æ</button>
    </div>
  </div>

  <div class="card">
    <h3>üìä –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</h3>
    <button id="view-results-btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</button>
    <button id="manage-users-btn">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</button>
  </div>

  <button class="btn-secondary" id="logout-admin">üö™ –í—ã–π—Ç–∏</button>
</div>

<!-- –≠–∫—Ä–∞–Ω 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
<div id="admin-setup-screen" class="screen admin-panel">
  <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—É—á–∞—é—â–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h2>
  
  <div class="card">
    <h3>üìö –£—á–µ–±–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª</h3>
    <textarea id="training-material" rows="10" placeholder="–í–≤–µ–¥–∏—Ç–µ —É—á–µ–±–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª (–º–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Word)...">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É CMMS. –≠—Ç–æ –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ —Å–∏—Å—Ç–µ–º—ã...</textarea>
  </div>
  
  <div class="card">
    <h3>‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (10 –≤–æ–ø—Ä–æ—Å–æ–≤)</h3>
    <div id="questions-container">
      <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
    </div>
    <button id="add-question-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
  </div>
  
  <button id="save-training-btn" class="btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</button>
  <button class="btn-secondary" id="back-to-admin-dashboard">‚Üê –ù–∞–∑–∞–¥ –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
</div>

<!-- –≠–∫—Ä–∞–Ω 4: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
<div id="results-screen" class="screen admin-panel">
  <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
  <table class="results-table">
    <thead>
      <tr>
        <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
        <th>–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞</th>
        <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
      </tr>
    </thead>
    <tbody id="results-body">
      <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
    </tbody>
  </table>
  <button class="btn-secondary" id="back-to-admin-from-results">‚Üê –ù–∞–∑–∞–¥ –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
</div>

<!-- –≠–∫—Ä–∞–Ω 5: –ò–∑—É—á–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
<div id="study-screen" class="screen">
  <h2>üìñ –û–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h2>
  <div id="study-content" class="card">
    <!-- –ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∑–¥–µ—Å—å -->
  </div>
  <button id="start-test-btn">üéØ –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</button>
  <button class="btn-secondary" id="logout-study">üö™ –í—ã–π—Ç–∏</button>
</div>

<!-- –≠–∫—Ä–∞–Ω 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
<div id="test-screen" class="screen">
  <h2>üß† –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞–Ω–∏–π</h2>
  <div id="test-progress">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 10</div>
  <div class="card">
    <h3 id="question-text">–í–æ–ø—Ä–æ—Å –±—É–¥–µ—Ç –∑–¥–µ—Å—å</h3>
    <input type="text" id="answer-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç...">
  </div>
  <button id="next-question-btn">–î–∞–ª–µ–µ ‚Üí</button>
  <div id="test-msg" class="note"></div>
</div>

<!-- –≠–∫—Ä–∞–Ω 7: –†–∞–±–æ—á–µ–µ –æ–∫–Ω–æ -->
<div id="workspace-screen" class="screen">
  <h2>üõ†Ô∏è –†–∞–±–æ—á–µ–µ –æ–∫–Ω–æ CMMS</h2>
  
  <div class="card">
    <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–∞–±–æ—á—É—é –∑–æ–Ω—É!</h3>
    <p>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <strong id="current-user-role"></strong></p>
    
    <div style="display: flex; gap: 10px; margin: 15px 0;">
      <button onclick="alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è')">üìä –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</button>
      <button onclick="alert('–§—É–Ω–∫—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤')">üìà –û—Ç—á–µ—Ç—ã</button>
      <button onclick="alert('–§—É–Ω–∫—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π')">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
    </div>
  </div>

  <!-- –î–ª—è –∞–¥–º–∏–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
  <div id="admin-workspace-features" style="display: none;">
    <div class="card">
      <h3>üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
      <div style="display: flex; gap: 10px;">
        <button onclick="alert('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
        <button onclick="alert('–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button onclick="ScreenManager.show('admin-setup-screen')">üìö –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</button>
      </div>
    </div>
  </div>

  <button class="btn-secondary" id="logout-workspace">üö™ –í—ã–π—Ç–∏</button>
</div>

<script>
// –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
class CMMSStorage {
    static getUsers() {
        const storedUsers = JSON.parse(localStorage.getItem('cmms_users'));
        if (!storedUsers) {
            // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - —Å–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const defaultUsers = {
                'admin': { 
                    password: 'admin123', 
                    role: 'admin', 
                    firstLogin: false,
                    fullName: '–ì–ª–∞–≤–Ω—ã–π –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
                },
                'engineer': { 
                    password: 'engineer123', 
                    role: 'engineer', 
                    firstLogin: true,
                    fullName: '–°–µ—Ä–≥–µ–π –ü–µ—Ç—Ä–æ–≤'
                }
            };
            this.saveUsers(defaultUsers);
            return defaultUsers;
        }
        return storedUsers;
    }

    static saveUsers(users) {
        localStorage.setItem('cmms_users', JSON.stringify(users));
    }

    static getTrainingData() {
        return JSON.parse(localStorage.getItem('cmms_training')) || {
            material: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É CMMS. –≠—Ç–æ –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ —Å–∏—Å—Ç–µ–º—ã...',
            questions: []
        };
    }

    static saveTrainingData(data) {
        localStorage.setItem('cmms_training', JSON.stringify(data));
    }

    static getTestResults() {
        return JSON.parse(localStorage.getItem('cmms_results')) || [];
    }

    static saveTestResult(result) {
        const results = this.getTestResults();
        results.push(result);
        localStorage.setItem('cmms_results', JSON.stringify(results));
    }
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞–º–∏
class ScreenManager {
    static show(screenId) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });
        document.getElementById(screenId).classList.add('active');
    }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentUser = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    initializeAdminPanel();
    initializeLoginSystem();
});

// –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
function initializeAdminPanel() {
    const questionsContainer = document.getElementById('questions-container');
    const trainingData = CMMSStorage.getTrainingData();

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
    loadQuestions();

    document.getElementById('add-question-btn').addEventListener('click', function() {
        addNewQuestion();
    });

    document.getElementById('save-training-btn').addEventListener('click', function() {
        saveTrainingData();
    });

    document.getElementById('admin-setup-btn').addEventListener('click', function() {
        ScreenManager.show('admin-setup-screen');
    });

    document.getElementById('admin-workspace-btn').addEventListener('click', function() {
        showWorkspace();
    });

    document.getElementById('view-results-btn').addEventListener('click', function() {
        loadResultsTable();
        ScreenManager.show('results-screen');
    });

    document.getElementById('back-to-admin-dashboard').addEventListener('click', function() {
        ScreenManager.show('admin-dashboard-screen');
    });

    document.getElementById('back-to-admin-from-results').addEventListener('click', function() {
        ScreenManager.show('admin-dashboard-screen');
    });

    document.getElementById('manage-users-btn').addEventListener('click', function() {
        alert('–§—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ');
    });

    function loadQuestions() {
        questionsContainer.innerHTML = '';
        trainingData.questions.forEach((question, index) => {
            addQuestionToUI(question, index);
        });
    }

    function addNewQuestion() {
        if (trainingData.questions.length >= 10) {
            alert('–ú–∞–∫—Å–∏–º—É–º 10 –≤–æ–ø—Ä–æ—Å–æ–≤');
            return;
        }
        
        const newQuestion = {
            text: '',
            correctAnswer: ''
        };
        
        trainingData.questions.push(newQuestion);
        addQuestionToUI(newQuestion, trainingData.questions.length - 1);
    }

    function addQuestionToUI(question, index) {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question-item';
        questionDiv.innerHTML = `
            <strong>–í–æ–ø—Ä–æ—Å ${index + 1}:</strong>
            <input type="text" class="question-text" data-index="${index}" 
                   placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞" value="${question.text}">
            <input type="text" class="question-answer" data-index="${index}" 
                   placeholder="–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç" value="${question.correctAnswer}">
            <button class="btn-danger remove-question" data-index="${index}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        `;
        questionsContainer.appendChild(questionDiv);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        questionDiv.querySelector('.remove-question').addEventListener('click', function() {
            const index = parseInt(this.getAttribute('data-index'));
            trainingData.questions.splice(index, 1);
            loadQuestions();
        });
    }

    function saveTrainingData() {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª
        trainingData.material = document.getElementById('training-material').value;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–æ–ø—Ä–æ—Å—ã
        document.querySelectorAll('.question-text').forEach(input => {
            const index = parseInt(input.getAttribute('data-index'));
            trainingData.questions[index].text = input.value;
        });
        
        document.querySelectorAll('.question-answer').forEach(input => {
            const index = parseInt(input.getAttribute('data-index'));
            trainingData.questions[index].correctAnswer = input.value;
        });

        CMMSStorage.saveTrainingData(trainingData);
        alert('‚úÖ –û–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
    }
}

// –°–∏—Å—Ç–µ–º–∞ –≤—Ö–æ–¥–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
function initializeLoginSystem() {
    document.getElementById('login-btn').addEventListener('click', handleLogin);

    document.getElementById('logout-admin').addEventListener('click', logout);
    document.getElementById('logout-study').addEventListener('click', logout);
    document.getElementById('logout-workspace').addEventListener('click', logout);

    document.getElementById('start-test-btn').addEventListener('click', function() {
        startEmployeeTest();
    });

    document.getElementById('next-question-btn').addEventListener('click', handleNextQuestion);
}

function handleLogin() {
    const login = document.getElementById('login').value.trim();
    const password = document.getElementById('password').value.trim();
    const users = CMMSStorage.getUsers();

    if (!users[login] || users[login].password !== password) {
        document.getElementById('login-msg').textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
        return;
    }

    currentUser = { login, ...users[login] };
    
    if (currentUser.role === 'admin') {
        // –ê–¥–º–∏–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –¥–∞—à–±–æ—Ä–¥
        ScreenManager.show('admin-dashboard-screen');
    } else {
        // –ò–Ω–∂–µ–Ω–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–±—ã—á–Ω—ã–π –ø—É—Ç—å
        if (currentUser.firstLogin) {
            loadStudyMaterials();
            ScreenManager.show('study-screen');
        } else {
            showWorkspace();
        }
    }
}

function showWorkspace() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    document.getElementById('current-user-role').textContent = 
        currentUser.role === 'admin' ? 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '‚öôÔ∏è –ò–Ω–∂–µ–Ω–µ—Ä';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
    const adminFeatures = document.getElementById('admin-workspace-features');
    adminFeatures.style.display = currentUser.role === 'admin' ? 'block' : 'none';
    
    ScreenManager.show('workspace-screen');
}

function loadStudyMaterials() {
    const trainingData = CMMSStorage.getTrainingData();
    document.getElementById('study-content').innerHTML = `
        <div style="white-space: pre-wrap; line-height: 1.5;">${trainingData.material}</div>
    `;
}

let currentTest = {
    questions: [],
    currentQuestionIndex: 0,
    userAnswers: []
};

function startEmployeeTest() {
    const trainingData = CMMSStorage.getTrainingData();
    
    if (trainingData.questions.length === 0) {
        alert('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª –≤–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞');
        return;
    }

    currentTest = {
        questions: trainingData.questions,
        currentQuestionIndex: 0,
        userAnswers: []
    };

    ScreenManager.show('test-screen');
    showCurrentQuestion();
}

function showCurrentQuestion() {
    const question = currentTest.questions[currentTest.currentQuestionIndex];
    document.getElementById('question-text').textContent = question.text;
    document.getElementById('test-progress').textContent = 
        `–í–æ–ø—Ä–æ—Å ${currentTest.currentQuestionIndex + 1} –∏–∑ ${currentTest.questions.length}`;
    document.getElementById('answer-input').value = '';
}

function handleNextQuestion() {
    const answer = document.getElementById('answer-input').value.trim();
    
    if (!answer) {
        document.getElementById('test-msg').textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç';
        return;
    }

    currentTest.userAnswers.push(answer);
    currentTest.currentQuestionIndex++;
    
    if (currentTest.currentQuestionIndex < currentTest.questions.length) {
        showCurrentQuestion();
    } else {
        completeTest();
    }
}

function completeTest() {
    const users = CMMSStorage.getUsers();
    
    // –ü–æ–º–µ—á–∞–µ–º, —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø—Ä–æ—à–µ–ª –æ–±—É—á–µ–Ω–∏–µ
    users[currentUser.login].firstLogin = false;
    CMMSStorage.saveUsers(users);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
    const trainingData = CMMSStorage.getTrainingData();
    let correctAnswers = 0;
    
    currentTest.userAnswers.forEach((answer, index) => {
        if (answer.toLowerCase() === trainingData.questions[index].correctAnswer.toLowerCase()) {
            correctAnswers++;
        }
    });

    CMMSStorage.saveTestResult({
        user: currentUser.login,
        date: new Date().toLocaleDateString('ru-RU'),
        score: `${correctAnswers}/${trainingData.questions.length}`,
        status: correctAnswers >= trainingData.questions.length * 0.7 ? '–°–¥–∞–Ω' : '–ù–µ —Å–¥–∞–Ω'
    });

    // –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–±–æ—á–µ–µ –æ–∫–Ω–æ
    showWorkspace();
}

function loadResultsTable() {
    const results = CMMSStorage.getTestResults();
    const tbody = document.getElementById('results-body');
    
    tbody.innerHTML = results.map(result => `
        <tr>
            <td>${result.user}</td>
            <td>${result.date}</td>
            <td>${result.score}</td>
            <td>${result.status}</td>
        </tr>
    `).join('');
}

function logout() {
    currentUser = null;
    ScreenManager.show('login-screen');
    document.getElementById('login').value = '';
    document.getElementById('password').value = '';
    document.getElementById('login-msg').textContent = '';
}
</script>
</body>
</html>
